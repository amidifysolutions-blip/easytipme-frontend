<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EazyTipMe | Management Hub</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root { --apple-bg: #F5F5F7; --apple-blue: #007AFF; --apple-red: #FF3B30; --apple-green: #34C759; }
        body { font-family: 'Inter', sans-serif; margin: 0; display: flex; height: 100vh; background: var(--apple-bg); color: #1D1D1F; overflow: hidden; }
        
        /* Sidebar */
        .sidebar { width: 260px; background: #000; color: white; padding: 30px 20px; display: flex; flex-direction: column; }
        .nav-item { padding: 14px 18px; cursor: pointer; border-radius: 12px; margin-bottom: 8px; transition: 0.3s; opacity: 0.6; font-size: 14px; }
        .nav-item.active { background: #333; opacity: 1; font-weight: 600; }
        .nav-item:hover { opacity: 1; background: #222; }

        .main { flex: 1; padding: 40px; overflow-y: auto; }
        .card { background: #FFF; padding: 30px; border-radius: 24px; box-shadow: 0 4px 24px rgba(0,0,0,0.04); margin-bottom: 25px; border: 1px solid #E5E5E7; }
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 25px; }
        
        label { display: block; font-size: 11px; font-weight: 700; margin-bottom: 8px; color: #86868B; text-transform: uppercase; }
        input, select, textarea { width: 100%; padding: 12px; border: 1px solid #D2D2D7; border-radius: 12px; font-size: 14px; margin-bottom: 15px; background: #FBFBFD; outline: none; box-sizing: border-box; }
        
        .days-row { display: flex; gap: 6px; flex-wrap: wrap; margin-bottom: 20px; }
        .day-btn { padding: 8px 12px; border: 1px solid #D2D2D7; border-radius: 10px; cursor: pointer; font-size: 11px; background: #FFF; transition: 0.2s; }
        .day-btn.selected { background: #000; color: #FFF; border-color: #000; }

        .btn-main { background: #000; color: #FFF; border: none; padding: 16px; border-radius: 14px; width: 100%; cursor: pointer; font-weight: 600; font-size: 16px; transition: 0.3s; }
        
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th { text-align: left; color: #86868B; font-size: 10px; padding: 15px; border-bottom: 1px solid #E5E5E7; text-transform: uppercase; }
        td { padding: 15px; border-bottom: 1px solid #F5F5F7; font-size: 13px; }

        .img-prev { width: 50px; height: 50px; border-radius: 50%; object-fit: cover; background: #f0f0f2; margin-top: 5px; }
        .signature { margin-top: auto; padding: 20px 10px; border-top: 1px solid #333; font-size: 10px; color: #636366; letter-spacing: 1px; font-weight: 700; text-transform: uppercase; }
        .status-badge { padding: 4px 8px; border-radius: 6px; font-size: 10px; font-weight: 700; }
        .pending { background: #FFF9E6; color: #FFB800; }
    </style>
</head>
<body>

<div class="sidebar">
    <div style="text-align: center; margin-bottom: 40px;">
        <img id="sideLogo" src="" style="width: 55px; border-radius: 14px; display: none; margin: 0 auto 10px; background: #fff;">
        <h2 id="sideStoreName" style="font-size: 18px; margin: 0;">Business Admin</h2>
    </div>
    
    <div class="nav-item active" onclick="showTab('reg')">Team Management</div>
    <div class="nav-item" onclick="showTab('set')">Company Profile</div>

    <div class="signature">Power by amidify solutions inc</div>
</div>

<div class="main">
    <div id="section-reg" class="section">
        <div class="card">
            <h3>Register New Specialist</h3>
            <div class="grid">
                <div>
                    <label>Public Nickname</label> <input type="text" id="nName" placeholder="e.g. Alex">
                    <label>Official Real Name</label> <input type="text" id="rName">
                    <label>Specialist Photo</label> 
                    <input type="file" id="staffImg" accept="image/*" onchange="preview(this, 'sPrev')">
                    <img id="sPrev" class="img-prev" src="">
                </div>
                <div>
                    <label>Job Title</label> <input type="text" id="job" placeholder="e.g. Senior Barber">
                    <label>Working Days</label>
                    <div class="days-row" id="daysPicker">
                        <div class="day-btn" onclick="this.classList.toggle('selected')">Mon</div>
                        <div class="day-btn" onclick="this.classList.toggle('selected')">Tue</div>
                        <div class="day-btn" onclick="this.classList.toggle('selected')">Wed</div>
                        <div class="day-btn" onclick="this.classList.toggle('selected')">Thu</div>
                        <div class="day-btn" onclick="this.classList.toggle('selected')">Fri</div>
                        <div class="day-btn" onclick="this.classList.toggle('selected')">Sat</div>
                        <div class="day-btn" onclick="this.classList.toggle('selected')">Sun</div>
                    </div>
                    <label>Standard Shift</label>
                    <div style="display:flex; gap:10px;">
                        <input type="time" id="s1_s"> <input type="time" id="s1_e">
                    </div>
                </div>
            </div>
            <button class="btn-main" onclick="saveStaff()">Add to Team</button>
        </div>

        <div class="card">
            <table>
                <thead>
                    <tr><th>Photo</th><th>Specialist</th><th>Payments</th><th>Status</th><th>Action</th></tr>
                </thead>
                <tbody id="staffTable"></tbody>
            </table>
        </div>
    </div>

    <div id="section-set" class="section" style="display:none;">
        <div class="card">
            <h3>Company Branding</h3>
            <div class="grid">
                <div>
                    <label>Business Display Name</label> <input type="text" id="set_name">
                    <label>Slogan (Max 90 chars)</label> <textarea id="set_slogan" maxlength="90"></textarea>
                </div>
                <div>
                    <label>Business Logo</label>
                    <input type="file" onchange="preview(this, 'lPrev')">
                    <img id="lPrev" style="width:80px; height:80px; object-fit:contain; border-radius:12px; margin-top:10px;">
                </div>
            </div>
            <button class="btn-main" onclick="saveCompany()">Update Identity</button>
        </div>
    </div>
</div>

<script>
    // جلب المعرف الفريد من الرابط
    const params = new URLSearchParams(window.location.search);
    const bizId = params.get('id') || 'demo';

    // مفاتيح تخزين معزولة لكل شركة
    const STAFF_KEY = `staff_${bizId}`;
    const CONFIG_KEY = `config_${bizId}`;

    let staffList = JSON.parse(localStorage.getItem(STAFF_KEY) || '[]');
    let currentStaffImg = "";
    let currentLogoImg = "";

    function preview(input, targetId) {
        const reader = new FileReader();
        reader.onload = (e) => {
            document.getElementById(targetId).src = e.target.result;
            if(targetId === 'sPrev') currentStaffImg = e.target.result;
            if(targetId === 'lPrev') currentLogoImg = e.target.result;
        };
        if(input.files[0]) reader.readAsDataURL(input.files[0]);
    }

    function saveStaff() {
        const name = document.getElementById('nName').value;
        if(!name) return;

        const member = {
            id: Date.now(),
            nName: name,
            job: document.getElementById('job').value,
            img: currentStaffImg || 'https://cdn-icons-png.flaticon.com/512/149/149071.png',
            stripeConnected: false, // الخطوة القادمة هي الموظف وسترايب
