<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Mouneh Store</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; margin: 0; display: flex; height: 100vh; background: #f4f7f6; }
        .sidebar { width: 260px; background: #000; color: white; display: flex; flex-direction: column; padding: 20px; box-sizing: border-box; }
        .nav-item { padding: 15px; cursor: pointer; border-radius: 8px; margin-bottom: 5px; transition: 0.3s; font-weight: 500; }
        .nav-item:hover, .nav-item.active { background: #333; }
        .main-content { flex: 1; padding: 40px; overflow-y: auto; }
        .section { display: none; }
        .card { background: white; padding: 25px; border-radius: 15px; box-shadow: 0 4px 20px rgba(0,0,0,0.05); }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { text-align: left; padding: 12px; border-bottom: 1px solid #eee; }
        input, select { width: 100%; padding: 10px; margin-top: 5px; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; margin-bottom: 15px; }
        .btn-black { background: #000; color: #fff; border: none; padding: 12px 25px; border-radius: 8px; cursor: pointer; font-weight: 600; }
    </style>
</head>
<body>

<div class="sidebar">
    <h2 style="font-size: 20px; margin-bottom: 30px;">EasyTipMe</h2>
    <div class="nav-item" onclick="showSection('reg')">Registry</div>
    <div class="nav-item" onclick="showSection('trans')">Transactions</div>
    <div class="nav-item" onclick="showSection('set')">Settings</div>
</div>

<div class="main-content">
    <div id="section-reg" class="section">
        <div class="card">
            <h2>Staff Registry (Mouneh)</h2>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                <div>
                    <label>Nickname</label>
                    <input type="text" id="nName" placeholder="e.g. Shani">
                    <label>Job Title</label>
                    <input type="text" id="job" placeholder="Barber">
                    <label>Days (Comma separated)</label>
                    <input type="text" id="days" placeholder="Mon, Tue, Wed">
                </div>
                <div>
                    <label>Shift Start</label>
                    <input type="time" id="sTime">
                    <label>Shift End</label>
                    <input type="time" id="eTime">
                    <label>Image URL</label>
                    <input type="text" id="img" placeholder="image-link.jpg">
                </div>
            </div>
            <button class="btn-black" onclick="saveStaff()">Register Staff</button>

            <table>
                <thead>
                    <tr>
                        <th>Avatar</th>
                        <th>Name</th>
                        <th>Job</th>
                        <th>Schedule (Days & Time)</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody id="staffTable"></tbody>
            </table>
        </div>
    </div>

    <div id="section-trans" class="section">
        <div class="card">
            <h2>Transaction Log</h2>
            <div id="transaction-list">
                <p style="color:#888; text-align:center; padding:20px;">No transactions recorded yet.</p>
            </div>
        </div>
    </div>

    <div id="section-set" class="section">
        <div class="card">
            <h2>Store Settings</h2>
            <label>Store Name</label>
            <input type="text" id="store_name_val" value="Mouneh Lebanese Gourmet Store">
            <label>Currency</label>
            <select><option>CAD ($)</option><option>USD ($)</option></select>
            <button class="btn-black" onclick="saveSettings()">Save Settings</button>
        </div>
    </div>
</div>

<script>
    // دالة التنقل وإصلاح مشكلة الريفرش
    function showSection(sec) {
        document.querySelectorAll('.section').forEach(s => s.style.display = 'none');
        document.getElementById('section-' + sec).style.display = 'block';
        
        document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
        const activeNav = document.querySelector(`[onclick="showSection('${sec}')"]`);
        if(activeNav) activeNav.classList.add('active');

        localStorage.setItem('activeTab', sec);
        if(sec === 'trans') renderTransactions();
    }

    // حفظ الموظف
    function saveStaff() {
        let staff = JSON.parse(localStorage.getItem('master_staff') || '[]');
        const newMember = {
            id: Date.now(),
            nName: document.getElementById('nName').value,
            job: document.getElementById('job').value,
            days: document.getElementById('days').value.split(','),
            sTime: document.getElementById('sTime').value,
            eTime: document.getElementById('eTime').value,
            img: document.getElementById('img').value || 'logo.png'
        };
        staff.push(newMember);
        localStorage.setItem('master_staff', JSON.stringify(staff));
        render();
        alert('Staff Added!');
    }

    // عرض جدول الموظفين مع التاريخ
    function render() {
        const staff = JSON.parse(localStorage.getItem('master_staff') || '[]');
        const table = document.getElementById('staffTable');
        table.innerHTML = staff.map(s => `
            <tr>
                <td><img src="${s.img}" style="width:35px; height:35px; border-radius:50%; object-fit:cover;"></td>
                <td><b>${s.nName}</b></td>
                <td>${s.job}</td>
                <td><small>${s.days.join(', ')}</small><br><b>${s.sTime} - ${s.eTime}</b></td>
                <td><button onclick="deleteStaff(${s.id})" style="color:red; background:none; border:none; cursor:pointer;">Delete</button></td>
            </tr>
        `).join('');
    }

    function deleteStaff(id) {
        let staff = JSON.parse(localStorage.getItem('master_staff') || '[]');
        staff = staff.filter(s => s.id !== id);
        localStorage.setItem('master_staff', JSON.stringify(staff));
        render();
    }

    function renderTransactions() {
        const logs = JSON.parse(localStorage.getItem('transactions') || '[]');
        const container = document.getElementById('transaction-list');
        if(logs.length === 0) return;
        container.innerHTML = logs.map(l => `
            <div style="display:flex; justify-content:space-between; padding:10px; border-bottom:1px solid #eee;">
                <span><b>${l.staffName}</b></span>
                <span style="color:green;">+$${l.amount}</span>
            </div>
        `).join('');
    }

    function saveSettings() {
        localStorage.setItem('store_name', document.getElementById('store_name_val').value);
        alert('Settings Saved!');
    }

    // تشغيل عند التحميل لمنع الريفرش من العودة للبداية
    window.onload = () => {
        const lastTab = localStorage.getItem('activeTab') || 'reg';
        showSection(lastTab);
        render();
    };
</script>

</body>
</html>
